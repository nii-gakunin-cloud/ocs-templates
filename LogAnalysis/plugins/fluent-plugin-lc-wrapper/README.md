# fluent-plugin-lc-wrapper

[Fluentd](https://fluentd.org/) parser plugin for parsing logs generated by [LC Wrapper](https://github.com/NII-cloud-operation/Jupyter-LC_wrapper) (such as Jupyter notebook cell execution logs) into structured records.

## Installation

### RubyGems

```
$ gem install fluent-plugin-lc-wrapper
```

### Bundler

Add the following line to your Gemfile:

```ruby
gem "fluent-plugin-lc-wrapper"
```

And then execute:

```
$ bundle
```

## Configuration

Example configuration:

```conf
<parse>
  @type lc_wrapper
  # time_format and types are set by default, but can be overridden if needed
  # time_format %Y-%m-%d %H:%M:%S(%Z)
  # types { 'uid' => 'integer', 'gid' => 'integer', 'start_time' => 'time', 'end_time' => 'time' }
</parse>
```

You can generate a configuration template with:

```
$ fluent-plugin-config-format parser lc-wrapper
```

## Example

A sample log that can be parsed by this plugin:

```
{"lc_cell_meme": {"current": "cb98905e-35b8-11ef-bcb4-02420a64001e"}}
----
!ping -c 1 -v 172.30.2.160
----
path: /home/user/.log/20240629/20240629-022507-0651.log
notebook_path: Untitled.ipynb
lc_notebook_meme: b9f187ae-2c65-11ef-8eda-02420a64000d
server_signature: 9d315e0a-11b7-11ef-a0d3-02420a64000e
uid: 1001
gid: 100
start time: 2024-06-29 02:25:07(UTC)
----
PING 172.30.2.160 (172.30.2.160) 56(84) bytes of data.
64 bytes from 172.30.2.160: icmp_seq=1 ttl=63 time=0.186 ms
----
end time: 2024-06-29 02:25:09(UTC)
0 chunks with matched keywords or errors
----
execute_reply_status: ok
```

## Output fields

The following table shows the output fields extracted from the example log above:

| Field                | Example Value                                                      | Description                                      |
|----------------------|-------------------------------------------------------------------|--------------------------------------------------|
| lc_cell_meme         | cb98905e-35b8-11ef-bcb4-02420a64001e                              | Cell meme ID (from JSON header)                  |
| input                | !ping -c 1 -v 172.30.2.160\n                                      | Input command or code                            |
| path                 | /home/user/.log/20240629/20240629-022507-0651.log                 | Log file path                                    |
| notebook_path        | Untitled.ipynb                                                    | Notebook file name                               |
| lc_notebook_meme     | b9f187ae-2c65-11ef-8eda-02420a64000d                              | Notebook meme ID                                 |
| server_signature     | 9d315e0a-11b7-11ef-a0d3-02420a64000e                              | Server signature                                 |
| uid                  | 1001                                                              | User ID                                          |
| gid                  | 100                                                               | Group ID                                         |
| start_time           | 2024-06-29 02:25:07(UTC)                                          | Start time (converted to EventTime)              |
| output               | PING 172.30.2.160 (172.30.2.160) ...                              | Output/result                                    |
| end_time             | 2024-06-29 02:25:09(UTC)                                          | End time (converted to EventTime)                |
| execute_reply_status | ok                                                                 | Execution status                                 |

## Development

### Running Tests

```bash
# Standard tests
rake test

# Including performance tests
PERFORMANCE_TESTS=1 rake test
```

## License

* Copyright(C) 2024- NII Gakunin Cloud
* License: Apache License, Version 2.0
